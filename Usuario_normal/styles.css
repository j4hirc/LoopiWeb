:root {
    /* Paleta de Colores Moderna */
    --primary: #2D6A4F;       /* Verde Profundo */
    --primary-light: #40916C; /* Verde Medio */
    --accent: #D8F3DC;        /* Verde Muy Claro */
    --text-dark: #1B4332;
    --text-body: #526760;
    --bg-body: #F0F4F2;       /* Gris verdoso muy suave */
    --white: #FFFFFF;
    
    /* Colores Funcionales */
    --color-solicitud: #e8f5e9; --text-solicitud: #2e7d32;
    --color-canje: #f3e5f5;     --text-canje: #7b1fa2;
    --color-cupon: #fff3e0;     --text-cupon: #e65100;
    --color-logro: #fff8e1;     --text-logro: #f57f17;
    --color-fav: #ffebee;       --text-fav: #c62828;
    --color-edu: #e3f2fd;       --text-edu: #1565c0;

    /* Propiedades UI */
    --shadow-soft: 0 4px 20px -2px rgba(45, 106, 79, 0.1);
    --shadow-hover: 0 10px 25px -5px rgba(45, 106, 79, 0.15);
    --radius-card: 20px;
    --radius-btn: 12px;
    --nav-height: 70px;
}

body {
    background-color: var(--bg-body);
    font-family: 'Poppins', sans-serif;
    color: var(--text-dark);
    margin: 0;
    padding-top: var(--nav-height); /* Espacio para navbar fija */
    -webkit-font-smoothing: antialiased;
}

/* --- ANIMACIONES --- */
.fade-in { animation: fadeIn 0.6s ease-out; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* --- NAVBAR MODERNIZADA --- */
.navbar {
    background: rgba(255, 255, 255, 0.85);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(255,255,255,0.3);
    position: fixed; top: 0; left: 0; right: 0;
    height: var(--nav-height);
    z-index: 1000;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.03);
}

.nav-container {
    width: 100%; max-width: 1200px; padding: 0 20px;
    display: flex; justify-content: space-between; align-items: center;
}

.nav-logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 1.3rem; color: var(--primary); }
.logo-circle {
    background: var(--primary); color: white; width: 35px; height: 35px;
    border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1.1rem;
}

.nav-right { display: flex; align-items: center; gap: 15px; }

/* Icono Notificación */
.nav-item-icon {
    position: relative; cursor: pointer; width: 40px; height: 40px;
    display: flex; align-items: center; justify-content: center;
    border-radius: 50%; transition: 0.2s; color: var(--text-body);
}
.nav-item-icon:hover { background: rgba(0,0,0,0.05); color: var(--primary); }
.nav-item-icon i { font-size: 1.3rem; }

.badge {
    position: absolute; top: 5px; right: 5px;
    background: #ff4757; color: white; font-size: 0.65rem;
    font-weight: 700; width: 16px; height: 16px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    border: 2px solid white;
}

/* User Pill (Versión Desktop) */
.nav-user-pill {
    display: flex; align-items: center; gap: 10px;
    padding: 5px 12px 5px 5px; background: white;
    border: 1px solid rgba(0,0,0,0.08); border-radius: 30px;
    cursor: pointer; transition: 0.2s;
}
.nav-user-pill:hover { border-color: var(--primary); box-shadow: var(--shadow-soft); }
.nav-user-pill img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; }
.user-info-nav { display: flex; flex-direction: column; line-height: 1.1; margin-right: 5px; }
.user-name { font-size: 0.85rem; font-weight: 600; }
.user-info-nav small { font-size: 0.65rem; color: var(--text-body); }
.user-arrow { font-size: 0.7rem; color: var(--text-body); }

/* --- CONTENEDOR PRINCIPAL --- */
.main-container {
    max-width: 1200px; margin: 0 auto; padding: 25px 20px;
    display: flex; flex-direction: column; gap: 30px;
}

/* --- HERO CARD (BALANCE) --- */
.hero-card {
    background: linear-gradient(135deg, var(--primary) 0%, #1B4332 100%);
    border-radius: var(--radius-card);
    padding: 30px;
    color: white;
    position: relative; overflow: hidden;
    box-shadow: var(--shadow-hover);
    display: flex; align-items: center; justify-content: space-between;
}
.hero-card::after { /* Efecto brillo */
    content: ''; position: absolute; top: -50px; right: -50px;
    width: 200px; height: 200px; background: rgba(255,255,255,0.1);
    border-radius: 50%; filter: blur(40px);
}
.hero-content { z-index: 1; }
.hero-label { font-size: 0.9rem; opacity: 0.8; text-transform: uppercase; letter-spacing: 1px; }
.hero-content h1 { font-size: 3.5rem; font-weight: 700; margin: 5px 0 10px 0; letter-spacing: -1px; }
.hero-subtitle { font-size: 0.95rem; opacity: 0.9; margin-bottom: 20px; }

.rank-chip {
    display: inline-flex; align-items: center; gap: 8px;
    background: rgba(255,255,255,0.15); backdrop-filter: blur(5px);
    padding: 6px 12px; border-radius: 20px; font-size: 0.85rem;
    cursor: pointer; transition: 0.2s; border: 1px solid rgba(255,255,255,0.2);
}
.rank-chip:hover { background: rgba(255,255,255,0.25); }
.rank-chip img { width: 20px; height: 20px; }
.rank-chip i { font-size: 0.7rem; opacity: 0.7; }

.hero-decoration i {
    font-size: 8rem; color: white; opacity: 0.05;
    position: absolute; right: 20px; bottom: -20px; transform: rotate(-15deg);
}

/* --- GRID ACCIONES --- */
.section-title { font-size: 1.2rem; font-weight: 600; margin-bottom: 15px; color: var(--text-dark); }

.actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
    gap: 20px;
}

.action-card {
    background: white; border-radius: 20px; padding: 20px;
    display: flex; flex-direction: column; align-items: flex-start; justify-content: space-between;
    height: 160px; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    box-shadow: var(--shadow-soft); border: 1px solid rgba(0,0,0,0.02);
}
.action-card:hover { transform: translateY(-5px); box-shadow: var(--shadow-hover); }

.icon-box {
    width: 45px; height: 45px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center; font-size: 1.2rem;
    margin-bottom: 15px;
}
/* Colores dinámicos */
.icon-box.green { background: var(--color-solicitud); color: var(--text-solicitud); }
.icon-box.purple { background: var(--color-canje); color: var(--text-canje); }
.icon-box.orange { background: var(--color-cupon); color: var(--text-cupon); }
.icon-box.yellow { background: var(--color-logro); color: var(--text-logro); }
.icon-box.red { background: var(--color-fav); color: var(--text-fav); }
.icon-box.blue { background: var(--color-edu); color: var(--text-edu); }

.card-text h3 { font-size: 1rem; font-weight: 600; margin: 0 0 2px 0; }
.card-text p { font-size: 0.8rem; color: var(--text-body); margin: 0; }

/* --- SECCIÓN MAPA --- */
.map-section {
    background: white; border-radius: var(--radius-card); padding: 25px;
    box-shadow: var(--shadow-soft);
}
.section-header { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
.section-subtitle { font-size: 0.9rem; color: var(--text-body); margin: 0; }

.leyenda { display: flex; gap: 12px; font-size: 0.8rem; }
.badge-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 4px; }
.badge-dot.green { background: #2ecc71; }
.badge-dot.purple { background: #8E44AD; }

.filtros-wrapper { margin-bottom: 15px; overflow: hidden; }
.filtros-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 5px; scrollbar-width: none; }
.filtros-scroll::-webkit-scrollbar { display: none; }

.chip {
    padding: 8px 16px; border-radius: 20px; border: 1px solid #e0e0e0;
    background: white; color: var(--text-body); font-size: 0.85rem; font-weight: 500;
    cursor: pointer; white-space: nowrap; transition: 0.2s;
}
.chip:hover { background: #f5f5f5; }
.chip.active { background: var(--primary); color: white; border-color: var(--primary); }

.mapa-frame { position: relative; border-radius: 16px; overflow: hidden; height: 400px; }
.mapa-lienzo { width: 100%; height: 100%; background: #ddd; }

.btn-floating-map {
    position: absolute; top: 15px; right: 15px; z-index: 500;
    width: 45px; height: 45px; background: white; border-radius: 12px;
    border: none; box-shadow: 0 4px 15px rgba(0,0,0,0.15);
    font-size: 1.2rem; color: var(--text-dark); cursor: pointer;
    display: flex; align-items: center; justify-content: center; transition: 0.2s;
}
.btn-floating-map:hover { transform: scale(1.05); color: var(--primary); }

/* --- DROPDOWN MENÚS --- */
.dropdown-menu, .dropdown-notificaciones {
    position: absolute; top: 110%; right: 0;
    background: white; width: 260px; border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.1);
    opacity: 0; pointer-events: none; transform: translateY(-10px);
    transition: 0.2s ease; z-index: 2000; overflow: hidden;
    flex-direction: column;
}
/* Activar menu al añadir clase .active con JS */
.dropdown-menu.active, .dropdown-notificaciones.active { opacity: 1; pointer-events: auto; transform: translateY(0); display: flex; }

.menu-header-mobile { display: none; padding: 15px; background: #f8f9fa; border-bottom: 1px solid #eee; justify-content: space-between; align-items: center; font-weight: 600; }
.dropdown-menu a { padding: 12px 20px; text-decoration: none; color: var(--text-dark); font-size: 0.9rem; display: flex; align-items: center; gap: 10px; transition: 0.2s; }
.dropdown-menu a:hover { background: #f8f9fa; color: var(--primary); }
.dropdown-menu a.logout { color: #e74c3c; }
.divider { height: 1px; background: #eee; margin: 5px 0; }

/* Notificaciones Dropdown */
.dropdown-notificaciones { width: 320px; right: -100px; } /* Ajuste centro */
.noti-header { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; }
.noti-lista { max-height: 300px; overflow-y: auto; }
.noti-item { padding: 12px 15px; border-bottom: 1px solid #f9f9f9; font-size: 0.85rem; cursor: pointer; }
.noti-item:hover { background: #f9f9f9; }
.noti-item.no-leida { background: #f0f7f4; border-left: 3px solid var(--primary); }
.noti-titulo { font-weight: 600; margin-bottom: 2px; }
.noti-mensaje { color: var(--text-body); }
.noti-vacia { padding: 30px; text-align: center; color: #999; font-size: 0.9rem; display: flex; flex-direction: column; gap: 10px; }

/* --- MODALES (ESTILO iOS/CARD) --- */
.modal-backdrop {
    position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px);
    z-index: 10000; display: none; align-items: center; justify-content: center;
    opacity: 0; transition: opacity 0.3s;
}
.modal-backdrop[style*="display: flex"] { opacity: 1; }

.modal-card {
    background: white; width: 90%; max-width: 500px; border-radius: 24px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.2); overflow: hidden;
    transform: scale(0.95); transition: transform 0.3s; display: flex; flex-direction: column; max-height: 90vh;
}
.modal-backdrop[style*="display: flex"] .modal-card { transform: scale(1); }

.modal-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; }
.modal-header h3 { margin: 0; font-size: 1.1rem; }
.btn-close { background: none; border: none; font-size: 1.2rem; cursor: pointer; color: #999; }

.modal-body { padding: 25px; overflow-y: auto; }

/* Avatar Upload en Modal */
.avatar-upload { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 25px; }
.avatar-preview { width: 100px; height: 100px; border-radius: 50%; overflow: hidden; border: 3px solid var(--primary); padding: 3px; }
.avatar-preview img { width: 100%; height: 100%; object-fit: cover; border-radius: 50%; }
.btn-upload { background: #eee; padding: 8px 16px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; font-weight: 500; display: flex; align-items: center; gap: 6px; }

/* Inputs Modernos */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
.form-group { display: flex; flex-direction: column; gap: 6px; }
.full-width { grid-column: span 2; }
.form-group label { font-size: 0.8rem; font-weight: 600; color: var(--text-body); }
.form-group input, .form-group select {
    padding: 12px; border-radius: 10px; border: 1px solid #e0e0e0;
    font-family: inherit; font-size: 0.95rem; transition: 0.2s;
}
.form-group input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 3px var(--accent); }

.modal-footer { padding: 15px 25px; background: #f8f9fa; display: flex; justify-content: flex-end; gap: 10px; }
.btn-text { background: none; border: none; padding: 10px 20px; cursor: pointer; color: #666; font-weight: 500; }
.btn-primary { background: var(--primary); color: white; border: none; padding: 10px 25px; border-radius: 12px; cursor: pointer; font-weight: 600; box-shadow: 0 4px 10px rgba(45, 106, 79, 0.3); }

/* --- RESPONSIVE MOBILE --- */
@media (max-width: 768px) {
    .nav-user-pill { padding: 0; border: none; background: transparent; }
    .user-info-nav, .user-arrow { display: none; } /* Solo mostrar foto en móvil */
    .nav-user-pill img { width: 38px; height: 38px; border: 2px solid white; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    .dropdown-menu {
        position: fixed; top: auto; bottom: 0; width: 100%; right: 0; left: 0;
        border-radius: 20px 20px 0 0; transform: translateY(100%);
    }
    .dropdown-menu.active { transform: translateY(0); }
    .menu-header-mobile { display: flex; } /* Mostrar título menú en móvil */

    .dropdown-notificaciones {
        position: fixed; top: 70px; left: 10px; right: 10px; width: auto;
    }

    .main-container { padding: 15px; gap: 20px; }
    .hero-card { flex-direction: column; align-items: flex-start; gap: 15px; }
    .hero-decoration i { font-size: 6rem; right: 10px; bottom: 10px; }
    
    .actions-grid { grid-template-columns: repeat(2, 1fr); gap: 15px; }
}