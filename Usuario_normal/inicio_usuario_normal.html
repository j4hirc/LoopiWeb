<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mi Loopi | Inicio</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />

    <link rel="stylesheet" href="styles.css"> 
</head>

<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="logo-circle">
                    <i class="fa-solid fa-recycle"></i>
                </div>
                <span class="logo-text">Loopi</span>
            </div>

            <div class="nav-right">
                <div class="nav-item-icon" onclick="toggleNotificaciones()">
                    <i class="fa-regular fa-bell"></i> <span id="contadorNotificaciones" class="badge" style="display:none;">0</span>
                    
                    <div class="dropdown-notificaciones" id="panelNotificaciones" onclick="event.stopPropagation()">
                        <div class="noti-header">
                            <strong>Tus Avisos</strong>
                            <span onclick="marcarNotificacionesLeidas()" style="font-size:0.7rem; cursor:pointer; text-decoration:underline;">Marcar leídos</span>
                        </div>
                        <div id="listaNotificaciones" class="noti-lista">
                            <div class="noti-vacia">
                                <i class="fa-regular fa-bell-slash"></i>
                                <p>Sin novedades por ahora</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="nav-user-pill" onclick="toggleMenu()">
                    <img id="imgPerfilNav" src="https://via.placeholder.com/40" alt="Perfil">
                    <div class="user-info-nav">
                        <span id="nombreUsuarioNav" class="user-name">Hola, Usuario</span>
                        <small>Reciclador</small>
                    </div>
                    <i class="fa-solid fa-chevron-down user-arrow"></i>
                </div>

                <div class="dropdown-menu" id="userMenu">
                    <div class="menu-header-mobile">
                        <span>Menú</span>
                        <i class="fa-solid fa-xmark" onclick="toggleMenu()"></i>
                    </div>
                    <a href="#" id="btnAbrirPerfil"><i class="fa-regular fa-user"></i> Mi Perfil</a>
                    <a href="Form_reciclador/ser-reciclador.html"><i class="fa-solid fa-leaf"></i> Quiero ser Reciclador</a>
                    <div class="divider"></div>
                    <a href="#" id="btnLogout" class="logout"><i class="fa-solid fa-arrow-right-from-bracket"></i> Cerrar Sesión</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="main-container fade-in">

        <section class="hero-card">
            <div class="hero-content">
                <span class="hero-label">Balance Eco</span>
                <h1 id="puntosActuales">0</h1>
                <p class="hero-subtitle">Puntos disponibles para canje</p>
                
                <div class="rank-chip" onclick="abrirModalRangos()">
                    <img id="imgRango" src="" alt="Rango" style="display: none;">
                    <span id="rangoUsuario">Nivel Principiante</span>
                    <i class="fa-solid fa-chevron-right"></i>
                </div>
            </div>
            <div class="hero-decoration">
                <i class="fa-solid fa-leaf"></i>
            </div>
        </section>

        <section>
            <h3 class="section-title">¿Qué quieres hacer hoy?</h3>
            <div class="actions-grid">
                <div class="action-card" onclick="window.location.href='solicitud_recoleccion/nueva_solicitud.html'">
                    <div class="icon-box green"><i class="fa-solid fa-truck-fast"></i></div>
                    <div class="card-text">
                        <h3>Solicitar</h3>
                        <p>Retiro a domicilio</p>
                    </div>
                </div>

                <div class="action-card" onclick="window.location.href='catalogo/catalogo.html'">
                    <div class="icon-box purple"><i class="fa-solid fa-gift"></i></div>
                    <div class="card-text">
                        <h3>Canjear</h3>
                        <p>Premios y bonos</p>
                    </div>
                </div>

                <div class="action-card" onclick="window.location.href='cupones/mis_cupones.html'">
                    <div class="icon-box orange"><i class="fa-solid fa-ticket"></i></div>
                    <div class="card-text">
                        <h3>Cupones</h3>
                        <p>Mis canjes activos</p>
                    </div>
                </div>

                <div class="action-card" onclick="window.location.href='logro/mis_logros.html'">
                    <div class="icon-box yellow"><i class="fa-solid fa-trophy"></i></div>
                    <div class="card-text">
                        <h3>Logros</h3>
                        <p>Medallas obtenidas</p>
                    </div>
                </div>

                <div class="action-card" onclick="window.location.href='favorito/favorito.html'">
                    <div class="icon-box red"><i class="fa-solid fa-heart"></i></div>
                    <div class="card-text">
                        <h3>Favoritos</h3>
                        <p>Puntos guardados</p>
                    </div>
                </div>

                <div class="action-card" onclick="window.location.href='aprende/aprende.html'">
                    <div class="icon-box blue"><i class="fa-solid fa-book-open"></i></div>
                    <div class="card-text">
                        <h3>Aprende</h3>
                        <p>Tips de reciclaje</p>
                    </div>
                </div>
            </div>
        </section>

        <section class="map-section">
            <div class="section-header">
                <div>
                    <h3 class="section-title" style="margin-bottom:5px;">Explora tu zona</h3>
                    <p class="section-subtitle">Encuentra puntos verdes cerca de ti</p>
                </div>
                <div class="leyenda">
                    <span class="badge-dot green"></span> Reciclaje
                    <span class="badge-dot purple"></span> Canjes
                </div>
            </div>

            <div class="filtros-wrapper">
                <div id="contenedorBotonesMateriales" class="filtros-scroll">
                    <button class="chip active" data-id="todos">Todos</button>
                    </div>
            </div>

            <div class="mapa-frame">
                <button id="btnMiUbicacion" class="btn-floating-map" title="Ir a mi ubicación">
                    <i class="fa-solid fa-location-crosshairs"></i>
                </button>
                <div id="mapaUsuario" class="mapa-lienzo"></div>
            </div>
        </section>

    </div>

    <div class="modal-backdrop" id="modalPerfil">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Editar Perfil</h3>
                <button class="btn-close" onclick="cerrarModalPerfil()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <div class="avatar-upload">
                    <div class="avatar-preview">
                        <img id="perfilPreview" src="https://via.placeholder.com/100" alt="Avatar">
                    </div>
                    <label for="inputPerfilFoto" class="btn-upload">
                        <i class="fa-solid fa-camera"></i> Cambiar Foto
                    </label>
                    <input type="file" id="inputPerfilFoto" accept="image/*" hidden>
                </div>

                <form class="form-grid" onsubmit="event.preventDefault();">
                    <div class="form-group">
                        <label>Nombre</label>
                        <input type="text" id="perfilPrimerNombre" placeholder="Primer nombre">
                    </div>
                    <div class="form-group">
                        <label>Apellido</label>
                        <input type="text" id="perfilApellidoPaterno" placeholder="Apellido paterno">
                    </div>
                    <input type="hidden" id="perfilSegundoNombre">
                    <input type="hidden" id="perfilApellidoMaterno">

                    <div class="form-group full-width">
                        <label>Parroquia</label>
                        <select id="perfilParroquia">
                            <option value="">Cargando...</option>
                        </select>
                    </div>
                    
                    <div class="form-group full-width">
                        <label>Correo (No editable)</label>
                        <input type="email" id="perfilCorreo" disabled style="opacity:0.7">
                    </div>

                    <div class="form-group full-width">
                        <label>Cambiar Contraseña</label>
                        <div class="input-password-wrapper">
                            <input type="password" id="perfilPassword" placeholder="Dejar vacío para mantener">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-text" onclick="cerrarModalPerfil()">Cancelar</button>
                <button class="btn-primary" onclick="guardarPerfil()">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <div class="modal-backdrop" id="modalRangos">
        <div class="modal-card">
            <div class="modal-header">
                <h3>Tu Progreso</h3>
                <button class="btn-close" onclick="cerrarModalRangos()"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="modal-body">
                <div class="progress-header">
                    <p>Sigue reciclando para desbloquear emblemas.</p>
                    <div class="progress-track">
                        <div class="progress-fill" id="barraProgresoGlobal" style="width: 0%;"></div>
                    </div>
                    <small id="textoProgreso">Calculando nivel...</small>
                </div>
                <div id="listaRangosContainer" class="timeline-rangos">
                    </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <script src="inicio_usuario.js"></script>
</body>
</html>