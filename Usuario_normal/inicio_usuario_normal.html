<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mi Loopi | Inicio</title>
    <link rel="stylesheet" href="styles.css">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>

<body>

    <nav class="navbar">
        <div class="nav-logo">
            <a href="../index.html">
                <img src="../Imagenes/logo_icon.png" alt="Loop" class="animate-logo"
                    onerror="this.src='https://cdn-icons-png.flaticon.com/512/3405/3405802.png'">
            </a>
            <span class="logo-text">Loopi</span>
        </div>

        <div class="nav-right">
            <div class="nav-notificaciones" onclick="toggleNotificaciones()">
                <i class="fa-solid fa-bell"></i>
                <span id="contadorNotificaciones" class="badge" style="display:none;">0</span>

                <div class="dropdown-notificaciones" id="panelNotificaciones" onclick="event.stopPropagation()">
                    <div class="noti-header">
                        <strong>Notificaciones</strong>
                    </div>
                    <div id="listaNotificaciones" class="noti-lista">
                        <p class="noti-vacia">No tienes notificaciones</p>
                    </div>
                </div>
            </div>

            <div class="nav-user" onclick="toggleMenu()">
                <img id="imgPerfilNav" src="https://via.placeholder.com/40" alt="Perfil">
                <span id="nombreUsuarioNav" class="user-name">Cargando...</span>
                <i class="fa-solid fa-chevron-down user-arrow"></i>
            </div>

            <div class="dropdown-menu" id="userMenu">
                <div class="menu-header-mobile">
                    <span>Mi Cuenta</span>
                </div>
                <a href="#" id="btnAbrirPerfil"><i class="fa-solid fa-user"></i> Mi Perfil</a>
                <a href="Form_reciclador/ser-reciclador.html"><i class="fa-solid fa-briefcase"></i> Quiero ser
                    Reciclador</a>
                <a href="#" id="btnLogout" class="logout"><i class="fa-solid fa-right-from-bracket"></i> Cerrar
                    SesiÃ³n</a>
            </div>
        </div>
    </nav>

    <div class="main-container">

        <section class="points-card">
            <div class="points-info">
                <p>Tus Puntos Eco</p>
                <h1 id="puntosActuales">0</h1>

                <div class="rank-wrapper" onclick="abrirModalRangos()">
                    <img id="imgRango" src="" alt="Rango" style="display: none;">
                    <span class="rango-badge" id="rangoUsuario">Iniciando...</span>
                    <i class="fa-solid fa-circle-info info-icon"></i>
                </div>
            </div>
            <div class="points-icon">
                <i class="fa-solid fa-leaf"></i>
            </div>
        </section>

        <section class="actions-grid">
            <div class="action-card card-solicitud"
                onclick="window.location.href='solicitud_recoleccion/nueva_solicitud.html'">
                <div class="icon-circle"><i class="fa-solid fa-truck-fast"></i></div>
                <h3>Solicitud</h3>
                <p>Solicitar retiro</p>
            </div>

            <div class="action-card card-canje" onclick="window.location.href='catalogo/catalogo.html'">
                <div class="icon-circle"><i class="fa-solid fa-gift"></i></div>
                <h3>Canjear</h3>
                <p>Premios</p>
            </div>

            <div class="action-card card-cupones" onclick="window.location.href='cupones/mis_cupones.html'">
                <div class="icon-circle"><i class="fa-solid fa-ticket"></i></div>
                <h3>Mis Cupones</h3>
                <p>Ver QRs</p>
            </div>

            <div class="action-card card-logros" onclick="window.location.href='logro/mis_logros.html'">
                <div class="icon-circle"><i class="fa-solid fa-trophy"></i></div>
                <h3>Logros</h3>
                <p>Medallas</p>
            </div>

            <div class="action-card card-fav" onclick="window.location.href='favorito/favorito.html'">
                <div class="icon-circle"><i class="fa-solid fa-heart"></i></div>
                <h3>Favoritos</h3>
                <p>Guardados</p>
            </div>

            <div class="action-card card-edu" onclick="window.location.href='aprende/aprende.html'">
                <div class="icon-circle"><i class="fa-solid fa-book-open"></i></div>
                <h3>Aprende</h3>
                <p>Tips Eco</p>
            </div>

            <div class="action-card card-job" onclick="window.location.href='Form_reciclador/ser-reciclador.html'">
                <div class="icon-circle" style="background: #ECEFF1; color: #455A64;">
                    <i class="fa-solid fa-briefcase"></i>
                </div>
                <h3>Trabaja</h3>
                <p>Ãšnete</p>
            </div>

            <div class="action-card card-stats"
                onclick="window.location.href='stats_historial/estadisticas_historial.html'">
                <div class="icon-circle"><i class="fa-solid fa-chart-line"></i></div>
                <h3>Historial</h3>
                <p>EstadÃ­sticas</p>
            </div>
        </section>

        <section class="map-section">
            <div class="section-header">
                <h2>Explora tu zona</h2>

                <div class="filtros-container">
                    <div id="contenedorBotonesMateriales" class="filtros-scroll">
                        <button class="btn-filtro active" data-id="todos">Todos</button>
                    </div>
                </div>

                <div class="leyenda">
                    <div><span class="dot green"></span> Reciclaje</div>
                    <div><span class="dot purple"></span> Canjes</div>
                </div>
            </div>

            <div class="mapa-wrapper" style="position: relative;">
                <button id="btnMiUbicacion" onclick="irAMiUbicacion()" class="btn-ubicacion-flotante"
                    title="Ir a mi ubicaciÃ³n">
                    <i class="fa-solid fa-location-crosshairs"></i>
                </button>
                <div id="mapaUsuario" class="mapa-container"></div>
            </div>
        </section>

    </div>

    <div class="modal-overlay-perfil" id="modalPerfil">
        <div class="modal-container-perfil">
            <div class="modal-header-perfil">
                <span class="modal-title-perfil">Mi Perfil</span>
                <button class="modal-close-perfil" onclick="cerrarModalPerfil()">âœ•</button>
            </div>
            <div class="modal-body-perfil">
                <div class="profile-img-container">
                    <img id="perfilPreview" src="https://via.placeholder.com/100" class="profile-img-preview"
                        alt="Foto perfil">
                </div>
                <div style="text-align:center; margin-bottom: 20px;">
                    <label for="inputPerfilFoto" class="perfil-link-foto">Cambiar Foto</label>
                    <input type="file" id="inputPerfilFoto" accept="image/*" style="display:none;">
                </div>

                <div class="perfil-grid">
                    <div class="perfil-row">
                        <div class="perfil-col">
                            <label class="perfil-label">Primer Nombre</label>
                            <input type="text" id="perfilPrimerNombre" class="perfil-input">
                        </div>
                        <div class="perfil-col">
                            <label class="perfil-label">Segundo Nombre</label>
                            <input type="text" id="perfilSegundoNombre" class="perfil-input">
                        </div>
                    </div>
                    <div class="perfil-row">
                        <div class="perfil-col">
                            <label class="perfil-label">Apellido Paterno</label>
                            <input type="text" id="perfilApellidoPaterno" class="perfil-input">
                        </div>
                        <div class="perfil-col">
                            <label class="perfil-label">Apellido Materno</label>
                            <input type="text" id="perfilApellidoMaterno" class="perfil-input">
                        </div>
                    </div>

                    <div class="perfil-col">
                        <label class="perfil-label">Parroquia</label>
                        <select id="perfilParroquia" class="perfil-input">
                            <option value="">Cargando parroquias...</option>
                        </select>
                    </div>

                    <div class="perfil-col">
                        <label class="perfil-label">Correo ElectrÃ³nico</label>
                        <input type="email" id="perfilCorreo" class="perfil-input" disabled
                            style="background:#f0f0f0; color:#888;">
                    </div>
                    <div class="perfil-col">
                        <label class="perfil-label">Nueva ContraseÃ±a <small>(Dejar vacÃ­o si no cambia)</small></label>
                        <input type="password" id="perfilPassword" class="perfil-input" placeholder="******">
                    </div>
                </div>
            </div>
            <div class="modal-footer-perfil">
                <button class="btn-cancelar-perfil" onclick="cerrarModalPerfil()">Cancelar</button>
                <button class="btn-guardar-perfil" onclick="guardarPerfil()">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay-perfil" id="modalRangos">
        <div class="modal-container-perfil" style="max-width: 500px;">
            <div class="modal-header-perfil">
                <span class="modal-title-perfil">Tu Progreso</span>
                <button class="modal-close-perfil" onclick="cerrarModalRangos()">âœ•</button>
            </div>
            <div class="modal-body-perfil">
                <div style="text-align: center; margin-bottom: 20px;">
                    <p style="color: #7f8c8d; font-size: 0.9em;">Sigue reciclando para subir de nivel.</p>
                    <div class="progress-bar-container">
                        <div class="progress-bar-fill" id="barraProgresoGlobal" style="width: 0%;"></div>
                    </div>
                    <small id="textoProgreso" style="color:#2ecc71; font-weight:bold;">Calculando...</small>
                </div>
                <div id="listaRangosContainer" class="timeline-rangos">
                    <p style="text-align:center">Cargando rangos...</p>
                </div>
            </div>
        </div>
    </div>

    <div class="chat-fab" onclick="toggleChat()">
        <img id="imgEllieFab" src="../Imagenes/ELLIE_LOOPI.png" class="fab-img" alt="Ellie"
            onerror="this.src='https://i.pinimg.com/564x/87/15/8e/87158e8e772f777b7858eb56da6d3388.jpg'">
        <span class="tooltip-chat">Â¡PregÃºntame!</span>
    </div>

    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <div class="header-info">
                <div class="avatar-bot">
                    <img id="imgEllieHeader" src="../Imagenes/ELLIE_LOOPI.png" alt="Ellie"
                        onerror="this.src='https://i.pinimg.com/564x/87/15/8e/87158e8e772f777b7858eb56da6d3388.jpg'">
                </div>
                <div>
                    <h4>Ellie Loopi ðŸŒ¿</h4>
                    <small>En lÃ­nea</small>
                </div>
            </div>
            <button class="btn-close-chat" onclick="toggleChat()"><i class="fa-solid fa-xmark"></i></button>
        </div>

        <div class="chat-body" id="chatBody">
            <div class="msg bot">
                <p>Iniciando Sesion...</p>
                <span class="time">Ahora</span>
            </div>
        </div>

        <div class="chat-footer">
            <input type="text" id="chatInput" placeholder="Escribe tu duda..." onkeypress="checkEnter(event)">
            <button onclick="enviarMensaje()" id="btnSend"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="inicio_usuario.js"></script>
</body>

</html>