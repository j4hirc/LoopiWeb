<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <title>Panel Reciclador | Loopi</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="styles.css">

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="../Imagenes/logo_icon.png" class="logo-img" alt="Logo">
                <span>Loopi Reciclador</span>
            </div>

            <input type="checkbox" id="menu-toggle">
            <label for="menu-toggle" class="menu-icon"><i class="fa-solid fa-bars"></i></label>

            <ul class="nav-menu">
                <li><a href="#" id="btnAbrirPerfil"><i class="fa-solid fa-user"></i> Perfil</a></li>
                <li><a href="#" id="btnCerrarSesion" class="btn-logout">
                        <i class="fa-solid fa-right-from-bracket"></i> Salir
                    </a></li>
            </ul>
        </div>
    </nav>

    <header class="header">
        <div class="header-content">
            <div class="header-text">
                <h1>Panel del Reciclador</h1>
                <p>Gestiona tus entregas y actividad</p>
            </div>

            <div class="user-badge" id="saludoUsuario">
                <i class="fa-solid fa-circle-user"></i> Cargando...
            </div>
        </div>
    </header>

    <main class="dashboard-container">
        <h2 class="section-title">Accesos rápidos</h2>

        <div class="grid-cards">
            <div class="card card-orange" onclick="abrirModalMiPunto()">
                <div class="card-icon"><i class="fa-solid fa-map-location-dot"></i></div>
                <div class="card-info">
                    <h3>Mi Punto</h3>
                    <p>Gestionar ubicación y horarios</p>
                </div>
            </div>

            <div class="card card-teal" onclick="location.href='mis_entregas/mis_entregas.html'"
                style="position: relative;">
                <span class="badge-notificacion" id="badgeEntregas">0</span>

                <div class="card-icon"><i class="fa-solid fa-truck"></i></div>
                <div class="card-info">
                    <h3>Mis Entregas</h3>
                    <p>Solicitudes asignadas</p>
                </div>
            </div>

            <div class="card card-blue" onclick="location.href='historial_entregas/historial_entregas.html'">
                <div class="card-icon"><i class="fa-solid fa-clock-rotate-left"></i></div>
                <div class="card-info">
                    <h3>Historial</h3>
                    <p>Entregas realizadas</p>
                </div>
            </div>

            <div class="card card-purple" onclick="abrirEstadisticas()">
                <div class="card-icon"><i class="fa-solid fa-chart-pie"></i></div>
                <div class="card-info">
                    <h3>Mis Estadísticas</h3>
                    <p>Tu impacto ambiental</p>
                </div>
            </div>
        </div>
    </main>

    <section class="map-section">
        <div class="section-header">
            <h2>Explora tu zona</h2>
            <div class="leyenda">
                <span class="dot green"></span> Recolección
                <span class="dot purple"></span> Canjes
            </div>
        </div>

        <div class="filtros-container-center">
            <span class="filtro-label">Filtrar por:</span>
            <div id="contenedorBotonesMateriales" class="filtros-scroll-center">
                <button class="btn-filtro active" data-id="todos">Todos</button>
            </div>
        </div>

        <div class="mapa-wrapper">
            <button id="btnMiUbicacion" class="btn-ubicacion-flotante" title="Mi ubicación">
                <i class="fa-solid fa-location-crosshairs"></i>
            </button>
            <div id="mapaReciclador" class="mapa-container"></div>
        </div>
    </section>

    <div class="modal-overlay-perfil" id="modalMiPunto">
        <div class="modal-container-perfil" style="max-width: 650px;">
            <div class="modal-header-perfil">
                <span class="modal-title-perfil"><i class="fa-solid fa-shop"></i> Gestionar Mi Punto</span>
                <button class="modal-close-perfil" onclick="cerrarModalMiPunto()">✕</button>
            </div>
            
            <div class="modal-body-perfil">
                <input type="hidden" id="idPunto">
                
                <div class="profile-img-container" style="width: 100%; height: 150px; border-radius: 12px; margin-bottom: 10px;">
                    <img id="previewPunto" src="https://via.placeholder.com/400x150?text=Foto+del+Punto" 
                         style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;">
                </div>
                <div style="text-align:center; margin-bottom: 20px;">
                    <label for="inputFotoPunto" class="perfil-link-foto"><i class="fa-solid fa-camera"></i> Subir Foto</label>
                    <input type="file" id="inputFotoPunto" accept="image/*" style="display: none;">
                </div>

                <div class="perfil-grid">
                    <div class="perfil-col">
                        <label class="perfil-label">Nombre del Punto</label>
                        <input type="text" id="nombrePunto" class="perfil-input" placeholder="Ej: Recicladora El Sol">
                    </div>
                    
                    <div class="perfil-row">
                        <div class="perfil-col">
                            <label class="perfil-label">Parroquia</label>
                            <select id="parroquiaPunto" class="perfil-input">
                                <option value="">Cargando...</option>
                            </select>
                        </div>
                        <div class="perfil-col">
                            <label class="perfil-label">Dirección</label>
                            <input type="text" id="direccionPunto" class="perfil-input" placeholder="Calle principal y secundaria">
                        </div>
                    </div>

                    <div class="perfil-col">
                        <label class="perfil-label">Materiales que aceptas</label>
                        <div id="containerMaterialesCheck" class="materiales-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 8px; padding: 10px; background: #f8f9fa; border-radius: 8px; border: 1px solid #ddd;">
                            <small>Cargando...</small>
                        </div>
                    </div>

                    <div class="perfil-col">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px;">
                            <label class="perfil-label">Horarios de Atención</label>
                            <button class="btn-small-add" onclick="agregarFilaHorario()" style="background: #e8f5e9; color: #2ecc71; border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer;">
                                + Agregar Día
                            </button>
                        </div>
                        <div id="containerHorarios" style="display: flex; flex-direction: column; gap: 8px;"></div>
                    </div>

                    <div class="perfil-col">
                        <label class="perfil-label">Ubicación Exacta</label>
                        <div style="display: flex; gap: 10px; align-items: center; margin-bottom: 5px; background: #e0f2f1; padding: 8px; border-radius: 6px;">
                            <small style="color: #00695c; font-family: monospace;">
                                Lat: <span id="txtLatPunto">0.0</span>, Lng: <span id="txtLngPunto">0.0</span>
                            </small>
                            <button onclick="obtenerUbicacionActualGPS()" style="margin-left: auto; background: white; border: 1px solid #009688; color: #009688; border-radius: 4px; cursor: pointer; padding: 2px 6px;">
                                <i class="fa-solid fa-crosshairs"></i> Mi GPS
                            </button>
                        </div>
                        <div id="mapaEdicion" style="width: 100%; height: 250px; border-radius: 8px; border: 1px solid #ddd;"></div>
                        <small style="color: #666;">* Toca en el mapa para ajustar la ubicación.</small>
                    </div>
                </div>
            </div>
            
            <div class="modal-footer-perfil">
                <button class="btn-cancelar-perfil" onclick="cerrarModalMiPunto()">Cancelar</button>
                <button class="btn-guardar-perfil" id="btnGuardarPunto" onclick="guardarMiPunto()">Guardar Cambios</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay-perfil" id="modalPerfil">...</div> 
    <div class="modal-overlay-perfil" id="modalEstadisticas">...</div>

    <script src="reciclador.js"></script>
</body>
</html>